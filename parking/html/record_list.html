<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>消息中心</title>
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<link rel="stylesheet" href="../css/app.css">
	<link rel="stylesheet" href="../css/mui.min.css">
	<style>
		html,body, .mui-content { background: #F3F3F3; height: 100%;}
		.mui-scroll-wrapper{top: 100px;}
		.mui-bar-nav~.mui-content .mui-pull-top-pocket{top: 14px;}
		.info{font-size: 12px; color: #999;padding-left: 16px; background: #FFF; padding-top: 44px; padding-bottom: 13px;}
		
		.item_wrap{background: #FFF;margin-top: 22px;}
		.item{ border-top: 10px solid #F3F3F3; padding: 23px 16px 13px; height: 100px;box-sizing: border-box;}
		.item .title_wrap{display: flex; flex-direction: column;justify-content: space-between; height: 100%;}
		.item .title{font-size: 20px; color: #000;}
		.item .time{font-size: 15px; color: #666;}
		.item .text{font-size: 15px; color: #666; margin: 0px 20px;}
		.item .status{font-size: 15px; color: #EC9927;}
		.item .btn{width: 60px; background: #0B2A47; color: #fff; font-size: 13px; border-radius: 2px; height: 33px;}

	</style>



</head>

<body>

		<header class="mui-bar mui-bar-nav" >
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		    <!-- <img src="../images/back.png" class="mui-action-back">	 -->
		    <h1 class="mui-title">罚单记录</h1>
		</header>
		
		<div class="mui-content">
			<div class="info">已经处理或者超过两个小时的记录无法撤回</div>
			
			<!--下拉刷新容器-->
			<div id="pullrefresh" class=" mui-scroll-wrapper ">
				<div class="mui-scroll">
					<!--数据列表-->
					<div class="item_wrap">

						<div class="row_between item">
							<div class="title_wrap">
								<span class="title">皖AH2026</span>
								<div class="row">
									<span class="time">2019-07-08   14:08:26</span>
									<span class="text">已打印</span>
									<span class="status">合格</span>
								</div>
							</div>
							<button type="button" class="mui-btn mui-btn-link btn">撤回</button>
						</div>
						
						<div class="row_between item">
							<div class="title_wrap">
								<span class="title">皖AH2026</span>
								<div class="row">
									<span class="time">2019-07-08   14:08:26</span>
									<span class="text">已打印</span>
									<span class="status">合格</span>
								</div>
							</div>
							<button type="button" class="mui-btn mui-btn-link btn">撤回</button>
						</div>
						

					</div>
				</div>
			</div>

			<div class="empty_text">
				数据为空
			</div>

		</div>





<script src="../js/mui.js"></script>
<script src="../js/jquery-2.1.1.min.js"></script>
<script src="../js/myStorage.js"></script>
<script src="../js/app.js"></script>

<script>
	var h5pullDown = true;
	mui.init({
		pullRefresh: {
			container: '#pullrefresh',
			down: {
				callback: pulldownRefresh
			},
			up: {
				contentrefresh: '正在加载...',
				callback: pullupRefresh
			}
		}
	});
// 	mui.plusReady(function() {
// 		mui('#pullrefresh').pullRefresh().pullupLoading();
// 		getData(page);
// 	});
	/**
	 * 下拉刷新具体业务实现
	 */
	function pulldownRefresh() {
		setTimeout(function() {
			mui('#pullrefresh').pullRefresh().endPulldownToRefresh(); //refresh completed
			
			$(".express-list").html("");
			page=1;
			// getData(page);
			
		}, 1500);
	}
	var count = 0;
	/**
	 * 上拉加载具体业务实现
	 */
	function pullupRefresh() {
		setTimeout(function() {
			mui('#pullrefresh').pullRefresh().endPullupToRefresh(isEnd); //参数为true代表没有更多数据了。
			// getData(page);
		}, 1500);
	}
	if (mui.os.plus) {
		mui.plusReady(function() {

			setTimeout(function() {
				mui('#pullrefresh').pullRefresh().pullupLoading();
			}, 1000);
			
			// getData(page);
		});
	} else {
		mui.ready(function() {
			mui('#pullrefresh').pullRefresh().pullupLoading();
		});
	}

	function getData(pageIndex){
		$(".empty_text").hide();
		
		Global.commonAjax({
					url: "notifications?page="+pageIndex

				},
				function(data) {

					console.log(JSON.stringify(data));

					if(data)
					{
						var html="";
						data = data.data;
						if(data.data.length>0)
						{
							console.log("000-----111")
							for(var i=0;i<data.data.length;i++)
							{
								console.log("000-----222")
								html += '<li class="row_between item" data-id="'+data.data[i].id+'">';
								 if(data.data[i].icon){
									 html += '<img src="'+data.data[i].icon+'" >';
								 }
										html += 
										'<div class="content_wrap">'+
											'<span class="title">'+data.data[i].title+'</span>'+
											'<span class="content">'+data.data[i].content+'</span>'+
										'</div>'+
										'<span class="flex_one"></span>';
								if(data.data[i].created_at)	{
									html += '<span class="time">'+data.data[i].created_at+'</span>';
								}	
									html += 
									'</li>';
							}

							page++;

							$(".express-list").append(html);
						}
						else
						{
							isEnd=1;
						}


						if(pageIndex==1&&data.data.length==0)
						{
							$(".empty_text").show();
						}
					}
				},
				function(err) {

					console.log(err);

				})
	}

	var page=1;
	var isEnd=0;

	mui(".express-list").on('tap', 'li', function() {
		var id=$(this).attr("data-id");
		Global.openWindow({
			url:"detail.html?id="+id,
			id: "detail.html",
			waiting: {
				autoShow: false
			}
		})
	})
	
	mui(".express-list").on('tap', '.btn', function() {
	
		var id=$(this).attr("data-id");
		Global.openWindow({
			url:"reason.html?id="+id,
			id: "reason.html",
			waiting: {
				autoShow: false
			}
		})
	
	})


</script>
</body>

</html>