<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>消息中心</title>
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<link rel="stylesheet" href="../css/app.css">
	<link rel="stylesheet" href="../css/mui.min.css">
	<style>
		html,body, .mui-content { background: #FFFFFF; height: 100%;}
		.item_wrap{background: #FFF;}
		.item{ border-top: 10px solid #F3F3F3; padding: 26px 17px 27px; box-sizing: border-box; display: flex;flex-direction: column;}
		.item .title_wrap{display: flex; flex-direction: column;justify-content: space-between; height: 100%;}
		.item .title{font-size: 20px; color: #000; margin-bottom: 21px;}
		.item .content_item{font-size: 15px; color: #666; padding: 15px 0px;}
		.item .img_wrap{width: 120px;flex-flow: wrap;}
		.item .img_wrap img{width: 56px; height: 30px;margin-bottom: 2px; margin-right: 2px;}
		
		.item .btn{width: 80px; background: #0B2A47; color: #fff; font-size: 13px; border-radius: 2px; height: 33px;}

	</style>



</head>

<body>

		<header class="mui-bar mui-bar-nav" >
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		    <!-- <img src="../images/back.png" class="mui-action-back">	 -->
		    <h1 class="mui-title">未上传记录</h1>
		</header>
		
			<!--下拉刷新容器-->
			<div class="mui-content">
					<!--数据列表-->
					<div class="item_wrap">

						<!-- <div class="item">
							<div class="title">皖AH2026</div>
							
							<div class="content_item row_between">
								<span>违停车型</span>
								<span>燃油车（小型）</span>
							</div>
							<div class="content_item row_between">
								<span>路段中队</span>
								<span>公园中队</span>
							</div>
							<div class="content_item row_between">
								<span>拍照路段</span>
								<span>国庆路</span>
							</div>
							<div class="content_item row_between">
								<span>拍照时间</span>
								<span>2019-07-08  15:39:56</span>
							</div>
							<div class="content_item row_between">
								<span>备注信息</span>
								<span>违规停车</span>
							</div>
							<div class="content_item row_between">
								<span>拍照中队</span>
								<span>公园中队</span>
							</div>
							
							<div class="content_item row_between">
								<span>拍照人员</span>
								<span>李澔</span>
							</div>
							
							<div class="content_item row_between">
								<span>违章图片</span>
								<div class="img_wrap row">
									<img src="../images/splash.png">
									<img src="../images/splash.png">
									<img src="../images/splash.png">
									<img src="../images/splash.png">
								</div>
							</div>
							<div style="text-align: right;">
								<button type="button" class="mui-btn mui-btn-link btn">上传</button>
							</div>
							
						</div> -->

					</div>
					
					<div class="empty_text hideClass">
						数据为空
					</div>
			</div>

			

<script src="../js/mui.js"></script>
<script src="../js/jquery-2.1.1.min.js"></script>
<script src="../js/myStorage.js"></script>
<script src="../js/app.js"></script>

<script>
	
	var recordList;
	mui.init();
	mui.plusReady(function(){
		recordList = myStorage.getItem("recordList");
		console.log(recordList);
		console.log(recordList[0]);
		if(recordList && (recordList[0] != '[')){
			recordList = JSON.parse(recordList);
			setData();
		}else{
			console.log("8898999")
			$(".empty_text").removeClass("hideClass");
		}
	});
	
	function setData(){
		var html = "";
		for(var i=0; i<recordList.length; i++){
			var item = recordList[i];
			html += '<div class="item" data-id="'+i+'">'+
							'<div class="title">'+item.license_plate+'</div>'+
							'<div class="content_item row_between">'+
								'<span>违停车型</span>'+
								'<span>'+item.car_type+'</span>'+
							'</div>'+
							'<div class="content_item row_between">'+
								'<span>路段中队</span>'+
								'<span>'+item.teamName+'</span>'+
							'</div>'+
							'<div class="content_item row_between">'+
								'<span>拍照路段</span>'+
								'<span>'+item.roadName+'</span>'+
							'</div>'+
							'<div class="content_item row_between">'+
								'<span>拍照时间</span>'+
								'<span>'+item.photo_time+'</span>'+
							'</div>'+
							'<div class="content_item row_between">'+
								'<span>备注信息</span>'+
								'<span>'+item.remark+'</span>'+
							'</div>'+
							'<div class="content_item row_between">'+
								'<span>拍照中队</span>'+
								'<span>'+item.teamName+'</span>'+
							'</div>'+
							
							'<div class="content_item row_between">'+
								'<span>拍照人员</span>'+
								'<span>'+item.username+'</span>'+
							'</div>'+
							
							'<div class="content_item row_between">'+
								'<span>违章图片</span>'+
								'<div class="img_wrap row">'+
									'<img src="'+Global.imgUrl+item.photos[0]+'">'+
									'<img src="'+Global.imgUrl+item.photos[1]+'">'+
								'</div>'+
							'</div>'+
							'<div style="text-align: right;">'+
								'<button type="button" class="mui-btn mui-btn-link btn" data-id="'+i+'">上传</button>'+
							'</div></div>'
		}
		
		$(".item_wrap").append(html);
	}
	
	mui(".mui-content").on('tap', '.btn', function() {
		var index = $(this).data("id");
		console.log(index);
		var params = recordList[index];
		
		Global.commonAjax({
				url: "index/record_add",
				method: 'POST',
				data: params
			},
			function(data) {
				console.log(data);
				mui.toast("上传成功");
				recordList.splice(index, 1);
				myStorage.setItem("recordList", JSON.stringify(recordList));
				if(recordList){
					setData();
				}else{
					$(".empty_text").removeClass("hideClass");
				}
			},
			function(err, code) {
				mui.toast(err);
				
			}
		)
	
	})
	

</script>
</body>

</html>