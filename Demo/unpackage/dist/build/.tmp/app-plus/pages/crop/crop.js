(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/crop/crop"],{"0651":function(t,e,a){"use strict";var c=a("90dd"),n=a.n(c);n.a},1329:function(t,e,a){"use strict";a.r(e);var c=a("45f1"),n=a.n(c);for(var r in c)"default"!==r&&function(t){a.d(e,t,function(){return c[t]})}(r);e["default"]=n.a},"3b8d":function(t,e,a){"use strict";var c=function(){var t=this,e=t.$createElement;t._self._c},n=[];a.d(e,"a",function(){return c}),a.d(e,"b",function(){return n})},"45f1":function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var c=r(a("a34a")),n=a("692b");function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e,a,c,n,r,o){try{var i=t[r](o),u=i.value}catch(s){return void a(s)}i.done?e(u):Promise.resolve(u).then(c,n)}function i(t){return function(){var e=this,a=arguments;return new Promise(function(c,n){var r=t.apply(e,a);function i(t){o(r,c,n,i,u,"next",t)}function u(t){o(r,c,n,i,u,"throw",t)}i(void 0)})}}var u,s,p,h,g,f,d,l,v,m,I,T=t.getSystemInfoSync(),L=T.screenWidth,S=T.screenHeight-44,b=(T.pixelRatio,1),y=100,B=T.screenWidth,R={data:function(){return{name:"杨大宝",imageSrc:"https://img-cdn-qiniu.dcloud.net.cn/demo_crop.jpg",isShowImg:!1,cropperInitW:L,cropperInitH:S,cropperW:L,cropperH:S,cropperL:0,cropperT:0,transL:0,transT:0,scaleP:0,imageW:0,imageH:0,cutL:0,cutT:0,cutB:L,cutR:"100%",qualityWidth:B,innerAspectRadio:b}},onLoad:function(t){this.imageSrc=t.image},onNavigationBarButtonTap:function(t){this.getImageInfo()},mounted:function(){this.loadImage()},methods:{updateUserInfo:function(){var e=i(c.default.mark(function e(){return c.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return{userID:t.getStorageSync("userInfo").userID},e.next=3,(0,n.updateUserInfo)();case 3:e.sent;case 4:case"end":return e.stop()}},e,this)}));function a(){return e.apply(this,arguments)}return a}(),setData:function(t){var e=this;Object.keys(t).forEach(function(a){e.$set(e.$data,a,t[a])})},getImage:function(){var e=this;t.chooseImage({success:function(t){e.setData({imageSrc:t.tempFilePaths[0]}),e.loadImage()}})},loadImage:function(){var e=this;t.showLoading({title:"图片加载中..."}),t.getImageInfo({src:e.imageSrc,success:function(a){v=a.width/a.height,v>=1?(m=L,I=L/v):(m=L*v,I=L);var c=m>I?m:I;if(y=c>y?y:c,v>=1){var n=Math.ceil((L/v-(L/v-y))/2),r=n,o=Math.ceil((L-L+y)/2),i=o;e.setData({cropperW:L,cropperH:L/v,cropperL:Math.ceil((L-L)/2),cropperT:Math.ceil((L-L/v)/2),cutL:o,cutT:n,cutR:i,cutB:r,imageW:m,imageH:I,scaleP:m/L,qualityWidth:B,innerAspectRadio:v})}else{var u=Math.ceil((L*v-L*v)/2),s=u,p=Math.ceil((L-y)/2),h=p;e.setData({cropperW:L*v,cropperH:L,cropperL:Math.ceil((L-L*v)/2),cropperT:Math.ceil((L-L)/2),cutL:u,cutT:p,cutR:s,cutB:h,imageW:m,imageH:I,scaleP:m/L,qualityWidth:B,innerAspectRadio:v})}e.setData({isShowImg:!0}),t.hideLoading()}})},contentStartMove:function(t){u=t.touches[0].pageX,s=t.touches[0].pageY},contentMoveing:function(t){var e=(u-t.touches[0].pageX)*b,a=(s-t.touches[0].pageY)*b;e>0?this.cutL-e<0&&(e=this.cutL):this.cutR+e<0&&(e=-this.cutR),a>0?this.cutT-a<0&&(a=this.cutT):this.cutB+a<0&&(a=-this.cutB),this.setData({cutL:this.cutL-e,cutT:this.cutT-a,cutR:this.cutR+e,cutB:this.cutB+a}),u=t.touches[0].pageX,s=t.touches[0].pageY},contentTouchEnd:function(){},getImageInfo:function(){var e=this;t.showLoading({title:"图片生成中..."});var a=t.createCanvasContext("myCanvas");a.drawImage(e.imageSrc,0,0,m,I),a.draw(!0,function(){var a=(e.cropperW-e.cutL-e.cutR)/e.cropperW*m,c=(e.cropperH-e.cutT-e.cutB)/e.cropperH*I,r=e.cutL/e.cropperW*m,o=e.cutT/e.cropperH*I;t.canvasToTempFilePath({x:r,y:o,width:a,height:c,destWidth:a,destHeight:c,quality:.5,canvasId:"myCanvas",success:function(e){t.hideLoading(),console.log(e.tempFilePath," at pages/crop/crop.vue:279"),t.uploadFile({url:n.BASE_IMAGE_URL+"User/User/updateUserInfo",filePath:e.tempFilePath,name:"userImage",header:{userToken:t.getStorageSync("userInfo").token},formData:{userID:t.getStorageSync("userInfo").userID},success:function(e){if(console.log(e.data," at pages/crop/crop.vue:290"),e.data){var a=JSON.parse(e.data);1==a.status?(t.setStorageSync("userInfo",a.data.userInfo),t.navigateBack({delta:1})):999==a.status&&t.navigateTo({url:"/pages/login/login"})}else t.navigateTo({url:"/pages/login/login"})}})}})})},dragStart:function(t){p=t.touches[0].pageX,h=t.touches[0].pageY,g=this.cutL,d=this.cutR,l=this.cutB,f=this.cutT},dragMove:function(t){var e=t.target.dataset.drag;switch(e){case"right":var a=(p-t.touches[0].pageX)*b;d+a<0&&(a=-d),this.setData({cutR:d+a});break;case"left":a=(p-t.touches[0].pageX)*b;g-a<0&&(a=g),g-a>this.cropperW-this.cutR&&(a=g-(this.cropperW-this.cutR)),this.setData({cutL:g-a});break;case"top":a=(h-t.touches[0].pageY)*b;f-a<0&&(a=f),f-a>this.cropperH-this.cutB&&(a=f-(this.cropperH-this.cutB)),this.setData({cutT:f-a});break;case"bottom":a=(h-t.touches[0].pageY)*b;l+a<0&&(a=-l),this.setData({cutB:l+a});break;case"rightBottom":var c=(p-t.touches[0].pageX)*b,n=(h-t.touches[0].pageY)*b;l+n<0&&(n=-l),d+c<0&&(c=-d);var r=l+n,o=d+c;this.setData({cutB:r,cutR:o});break;default:break}}}};e.default=R}).call(this,a("6e42")["default"])},"90dd":function(t,e,a){},e7ef:function(t,e,a){"use strict";a.r(e);var c=a("3b8d"),n=a("1329");for(var r in n)"default"!==r&&function(t){a.d(e,t,function(){return n[t]})}(r);a("0651");var o=a("2877"),i=Object(o["a"])(n["default"],c["a"],c["b"],!1,null,null,null);e["default"]=i.exports}},[["9a84","common/runtime","common/vendor"]]]);